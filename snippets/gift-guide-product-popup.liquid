<!-- Product Popup Modal -->
<!-- Image + Info -->
<div class="product-flex">
  <div class="product-grid-image">
    <div class="image-wrapper">
      <img
        src="{{ product.featured_media.src | image_url: width:500 }}"
        alt="{{ product.title }}"
        width="120"
        height="140"
        loading="lazy"
      >
    </div>
    <div class="product_details">
      <h4>{{ product.title }}</h4>
      <div class="price"><span>{{ product.price | money }}</span></div>
      <div class="desc">{{ product.description | truncatewords: 14 }}</div>
    </div>
  </div>
  <div class="product-info">
    {%- assign color_index = 0 -%}
    {%- assign size_index = 0 -%}
    {%- for opt in product.options_with_values -%}
      {%- if opt.name == 'Color' -%}{%- assign color_index = forloop.index -%}{%- endif -%}
      {%- if opt.name == 'Size' -%}{%- assign size_index = forloop.index -%}{%- endif -%}
    {%- endfor -%}

    <div class="product-popup">
      {% if product.options contains 'Color' %}
        <div class="color-options">
          <label>Color</label>
          <ul class="color-buttons" data-option-index="{{ color_index }}">
            {% for opt in product.options_with_values %}
              {% if opt.name == 'Color' %}
                {% for value in opt.values %}
                  <li class="color-btn" data-value="{{ value }}">
                    <span class="color-swatch" style="background-color: {{ value | downcase }}"></span>
                    <span class="color-name">{{ value }}</span>
                  </li>
                {% endfor %}
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      {% if product.options contains 'Size' %}
        <div class="size-options">
          <label>Size</label>
          <div class="custom-dropdown" data-option-index="{{ size_index }}">
            <div class="dropdown-toggle">
                <span>Choose your size</span> 
                <span class="arrow-icon">
                    <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 2L8 8L14 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="square"/>
                    </svg>
                </span>
</div>
            <ul class="dropdown_menu">
              {% for opt in product.options_with_values %}
                {% if opt.name == 'Size' %}
                  {% for value in opt.values %}
                    <li class="size-item" data-value="{{ value }}">{{ value }}</li>
                  {% endfor %}
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}

      <!-- Variants JSON + hidden variant id -->
      <script type="application/json" class="product-variants-json">
        {{ product.variants | json }}
      </script>
      <product-form>
        <form method="post" action="/cart/add" class="product-form">
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <button type="submit" class="add-to-cart btn gift-btn"> 
            <span>Add to cart</span>
            <svg width="26" height="12" viewBox="0 0 26 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.22205 4.80469L0.472046 4.80469L0.472046 6.30469L1.22205 6.30469L1.22205 4.80469ZM25.7524 6.08502C26.0453 5.79213 26.0453 5.31725 25.7524 5.02436L20.9794 0.251388C20.6865 -0.0415053 20.2116 -0.0415053 19.9187 0.251388C19.6259 0.544281 19.6259 1.01916 19.9187 1.31205L24.1614 5.55469L19.9187 9.79733C19.6259 10.0902 19.6259 10.5651 19.9187 10.858C20.2116 11.1509 20.6865 11.1509 20.9794 10.858L25.7524 6.08502ZM1.22205 6.30469L25.222 6.30469L25.222 4.80469L1.22205 4.80469L1.22205 6.30469Z" fill="currentColor"/>
            </svg>
          </button>
        </form>
      </product-form>
    </div>
  </div>
</div>
